<!DOCTYPE html>
<html lang="en">

<head>
    <link rel="stylesheet"
          href="https://fonts.googleapis.com/css?family=Mukta">
    <meta charset="utf-8">
    <title>Basic network graph in d3.js</title>
    <style>
        .node_label{
            font-family: 'Mukta', serif;
            font-size: 11px;
            -webkit-touch-callout: none; /* iOS Safari */
            -webkit-user-select: none; /* Safari */
            -khtml-user-select: none; /* Konqueror HTML */
            -moz-user-select: none; /* Old versions of Firefox */
            -ms-user-select: none; /* Internet Explorer/Edge */
            user-select: none;
        }
        circle{
            transition: transform 1s;
            cursor: pointer;
        }
        circle:hover{
            transform: scale(1.25);
        }
    </style>
</head>




<section class="bg" style="padding-top: 20px; padding-bottom: 20px">
    <div class="container">
        <div class="row">

            </div>

            
            <!-- Load d3.js -->
            <script src="https://d3js.org/d3.v4.js"></script>

            <div id="git_commits_dag"></div>
            <script>

                // set the dimensions and margins of the graph
                var margin = { top: 10, right: 30, bottom: 30, left: 40 },
                    width = 900 - margin.left - margin.right,
                    height = 600 - margin.top - margin.bottom;


                var svg = d3.select("#git_commits_dag")
                    .append("svg")
                    .attr("width", width + margin.left + margin.right)
                    .attr("height", height + margin.top + margin.bottom)
                    .append("g")
                    .attr("transform",
                        "translate(" + margin.left + "," + margin.top + ")");
                
                svg.append("defs").selectAll("marker")
                    .data(["end"])
                    .enter().append("svg:marker")    // This section adds in the arrows
                    .attr("id", d => `arrow-${d}`)
                    .attr("viewBox", "0 -5 10 10")
                    .attr("refX", 15)
                    .attr("refY", -0.5)
                    .attr("markerWidth", 6)
                    .attr("markerHeight", 6)
                    .attr("orient", "auto")
                    .append("path")
                    .attr("fill", "#ffffff")
                    .attr("d", "M0,-5L10,0L0,5");

                    
                d3.json("/data/network_graph.json", function(data) {
                    
                    // Let's list the force we wanna apply on the network
                var simulation = d3.forceSimulation()
                        .force("link", d3.forceLink().id(function(d) { return d.id; }))
                        .force("charge", d3.forceManyBody())
                        .force("center", d3.forceCenter(width / 2, height / 2));
                
                    
                    // Initialize the links
                    var link = svg
                        .selectAll("line")
                        .data(data.links)
                        .enter()
                        .append("line")
                        .style("stroke", "#aaa")
                        .style("stroke-width", 3)

                    var node = svg.append("g")
                        .attr("class", "nodes")
                        .selectAll("g")
                        .data(data.nodes)
                        .enter().append("g")
                        
                    var circles = node.append("circle")
                        .attr("stroke", "#fff")
                        .attr("stroke-width", 1.5)
                        .attr("r", 8)
                        .style("fill", "#1f77b4")
                        .call(drag(simulation));

                    node.append("title")
                        .text(function(d) { return d.metadata; });        
                    
                    var lables = node.append("text")
                        .text(function(d) {
                            return d.date;
                        })
                        .attr('x', 18)
                        .attr('y', 3)
                        .attr("class", "node_label");

                    simulation
                        .nodes(data.nodes)
                        .on("tick", ticked);

                    simulation.force("link")
                        .links(data.links);
                    
                    // This function is run at each iteration of the force algorithm, updating the nodes position.
                    function ticked() {
                        link
                            .attr("x1", function (d) { return d.source.x; })
                            .attr("y1", function (d) { return d.source.y; })
                            .attr("x2", function (d) { return d.target.x; })
                            .attr("y2", function (d) { return d.target.y; });

                        node
                            // .attr("cx", function(d) {return d.x;})
                            // .attr("cy", function(d) {return d.y;});
                        .attr("transform", function(d) {
                            return "translate(" + d.x + "," + d.y + ")";
                        })
                    }

                });

                drag = simulation => {
  
                    function dragstarted(event) {
                        if (!d3.event.active) simulation.alphaTarget(0.3).restart();
                        event.fx = event.x;
                        event.fy = event.y;
                    }
                    
                    function dragged(event) {
                        event.fx = d3.event.x;
                        event.fy = d3.event.y;
                    }
                    
                    function dragended(event) {
                        if (!d3.event.active) simulation.alphaTarget(0);
                        event.fx = null;
                        event.fy = null;
                    }
                    
                    return d3.drag()
                        .on("start", dragstarted)
                        .on("drag", dragged)
                        .on("end", dragended);
                };

            </script>

            </body>

</html>